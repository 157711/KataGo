#include "../tests/tests.h"
using namespace TestCommon;

#include "../neuralnet/nneval.h"
#include "../dataio/trainingwrite.h"
#include "../program/play.h"

static NNEvaluator* startNNEval(
  const string& seed, Logger& logger,
  int defaultSymmetry, bool inputsUseNHWC, bool cudaUseNHWC, bool cudaUseFP16
) {
  //Placeholder, doesn't actually do anything since we have debugSkipNeuralNet = true
  string modelFile = "/dev/null";
  int modelFileIdx = 0;
  int maxBatchSize = 16;
  int maxConcurrentEvals = 1024;
  int posLen = NNPos::MAX_BOARD_LEN;
  bool requireExactPosLen = false;
  int nnCacheSizePowerOfTwo = 16;
  int nnMutexPoolSizePowerOfTwo = 12;
  bool debugSkipNeuralNet = true;
  double nnPolicyTemperature = 1.0;
  NNEvaluator* nnEval = new NNEvaluator(
    modelFile,
    modelFileIdx,
    maxBatchSize,
    maxConcurrentEvals,
    posLen,
    requireExactPosLen,
    inputsUseNHWC,
    nnCacheSizePowerOfTwo,
    nnMutexPoolSizePowerOfTwo,
    debugSkipNeuralNet,
    nnPolicyTemperature
  );
  (void)inputsUseNHWC;

  int numNNServerThreadsPerModel = 1;
  bool nnRandomize = false;
  vector<int> cudaGpuIdxByServerThread = {0};

  nnEval->spawnServerThreads(
    numNNServerThreadsPerModel,
    nnRandomize,
    seed,
    defaultSymmetry,
    logger,
    cudaGpuIdxByServerThread,
    cudaUseFP16,
    cudaUseNHWC
  );

  return nnEval;
}

void Tests::runTrainingWriteTests() {
  cout << "Running training write tests" << endl;
  string tensorflowGpuVisibleDeviceList = "";
  double tensorflowPerProcessGpuMemoryFraction = 0.3;
  NeuralNet::globalInitialize(tensorflowGpuVisibleDeviceList,tensorflowPerProcessGpuMemoryFraction);

  int inputsVersion = 3;
  int maxRows = 256;
  int posLen = 5;
  double firstFileMinRandProp = 1.0;
  int debugOnlyWriteEvery = 5;

  ostringstream out;
  Logger logger;
  logger.setLogToStdout(false);
  logger.setLogTime(false);
  logger.addOStream(out);

  auto run = [&](const string& seedBase, const Rules& rules) {
    TrainingDataWriter dataWriter(&out,inputsVersion, maxRows, firstFileMinRandProp, posLen, debugOnlyWriteEvery, seedBase+"dwriter");

    NNEvaluator* nnEval = startNNEval(seedBase+"nneval",logger,0,true,false,false);

    SearchParams params;
    params.maxVisits = 100;

    MatchPairer::BotSpec botSpec;
    botSpec.botIdx = 0;
    botSpec.botName = string("test");
    botSpec.nnEval = nnEval;
    botSpec.baseParams = params;

    Board initialBoard(5,5);
    Player initialPla = P_BLACK;
    int initialEncorePhase = 0;
    BoardHistory initialHist(initialBoard,initialPla,rules,initialEncorePhase);

    int numExtraBlack = 0;
    bool doEndGameIfAllPassAlive = true;
    bool clearBotAfterSearch = true;
    int maxMovesPerGame = 40;
    vector<std::atomic<bool>*> stopConditions;
    FancyModes fancyModes;
    fancyModes.initGamesWithPolicy = true;
    fancyModes.forkSidePositionProb = 0.10;
    bool recordFullData = true;
    Rand rand(seedBase+"play");
    FinishedGameData* gameData = Play::runGame(
      initialBoard,initialPla,initialHist,numExtraBlack,
      botSpec,botSpec,
      seedBase+"search",
      doEndGameIfAllPassAlive, clearBotAfterSearch,
      logger, false, false,
      maxMovesPerGame, stopConditions,
      fancyModes, recordFullData, posLen,
      rand
    );

    out << gameData->startHist.getRecentBoard(0) << endl;
    gameData->endHist.printDebugInfo(out,gameData->endHist.getRecentBoard(0));

    dataWriter.writeGame(*gameData);
    delete gameData;

    dataWriter.flushIfNonempty();

    delete nnEval;
  };

  run("testtrainingwrite-tt",Rules::getTrompTaylorish());

  Rules rules;
  rules.koRule = Rules::KO_SIMPLE;
  rules.scoringRule = Rules::SCORING_TERRITORY;
  rules.multiStoneSuicideLegal = false;
  rules.komi = 5;
  run("testtrainingwrite-jp",rules);

  string expected = R"%%(
HASH: 8333137CA06AB48A180FF32D05FA698B
   A B C D E
 5 . . . . .
 4 . . . . .
 3 . . . . .
 2 . . . . .
 1 . . . X .


HASH: 2E304EFF2E7F0FB19E8EA624B40B35F4
   A B C D E
 5 X X . X X
 4 . . X X X
 3 . X X . X
 2 O O X X X
 1 . X . X X


Encore phase 0
Rules koPOSITIONALscoreAREAsui1komi7.5
Ko prohib hash 00000000000000000000000000000000
White bonus score 0
Game result 0 Empty 0 0 0
Last moves D1 A2 A1 C1 D5 C5 C4 A3 E1 D3 A5 D4 D2 E5 E2 B2 B1 B4 C3 E4 E3 B3 B1 A1 D5 A4 E5 D4 B5 pass E4 D3 pass D3 C2 B1 B1 A2 D4 B2 B3
binaryInputNCHWPacked
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|u1','fortran_order':False,'shape':(9,22,4)}
FFFFFF80000000000000010000000000000000000000010000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000FFFFFF800000000000000000
FFFFFF801000090020010200000008003001030000000000000000000000000000000000200000001000000000000200000008000001000030000B0000000B0000000B000100400010000900200102000000000000000000
FFFFFF802025020091000980200008009000038001210000000000000000000000000000800000000004000000000080002000000100000020000B8020000B8020000B800000300020250200910009800000000000000000
FFFFFF808100398028A5820000000800A90033800000000000000000000000000000000000008000000010000800000000002000008000008100398081003B8081002B80000000008100398038A582000000000000000000
FFFFFF802AE58200810A318008C63180A1080200020000000000000000000000000000000002000000400000000800000200000000000400810800008108318081083180440040003AE58E00810A31800000000000000000
FFFFFF80910A318026318A00A000000010000200073BB98000000000000000000000000004000000100000000000080000000400001000008000020080000200800000000000400099CE318026318E000000000000000000
FFFFFF8006B18A00D94A3180C080000006318A00194A318000000000000000000000000000400000000000004000000000800000080000000080020000800200008002000000000006B18E00F94A31800000000000000000
FFFFFF80D94A7180000400000004000000000000C0000000000000000000000000000000000004000000400000040000000000000004000000040000000402000004020000000000FF7BFF80000400000000000000000000
FFFFFF8020A5020093000980300008008000038000210000000000000000000000000000020000000080000080000000000400000000008000000B8080000B8020000B800000300020A50200930009800000000000000000

globalInputNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(9,14)}
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 1 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 1 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5

policyTargetsNCMove
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<i2','fortran_order':False,'shape':(9,1,26)}
0 5 0 0 5 0 0 0 5 0 0 18 2 5 0 21 0 8 0 3 4 0 0 0 4 19
0 12 0 0 0 0 0 17 0 0 9 11 5 0 11 0 5 0 4 5 0 17 0 0 3 0
0 2 0 0 9 6 21 0 33 0 0 0 7 0 0 0 0 0 0 0 0 4 0 0 0 17
0 4 0 0 0 8 8 0 0 0 0 3 0 0 11 0 0 14 0 0 0 49 0 0 0 2
0 1 0 3 0 10 0 0 0 0 0 46 0 0 0 0 0 11 0 0 2 0 0 0 0 26
0 5 0 0 79 0 0 0 0 9 0 0 0 0 0 0 0 2 0 0 0 0 0 0 0 4
0 0 13 0 0 0 0 0 0 0 0 0 0 46 0 0 0 20 0 0 0 0 0 0 0 20
0 0 4 0 0 0 0 0 0 0 0 0 0 0 0 8 1 0 0 0 2 65 13 0 0 6
0 11 0 0 23 4 0 0 0 0 0 0 0 0 8 0 8 6 2 24 0 2 0 0 0 11

globalTargetsNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(9,54)}
0 1 0 -9.5 0.231906 0.545349 0 -3.07854 0.329797 0.348241 0 -0.292537 0.336345 0.32954 0 -9.55376e-05 0.328688 0.335708 0 -0 -9.5 0.00827174 0.000175622 8.98218e-05 0.000794163 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 0 1 1 0 0 0 0 0
1 0 0 9.5 0.578247 0.215929 0 3.5442 0.359067 0.325794 0 0.451985 0.327869 0.337901 0 0.000402594 0.327704 0.342771 0 0 9.5 0.0120156 0.000484093 0.000618412 5.42075e-05 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 5 1 1 0 0 0 0 0
0 1 0 -9.5 0.197538 0.616282 0 -4.08028 0.319482 0.376522 0 -0.69834 0.340281 0.328217 0 -0.00169653 0.333568 0.329309 0 -0 -9.5 0.00215308 0.0111788 8.11286e-05 1.56866e-05 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 10 1 1 0 0 0 0 0
1 0 0 9.5 0.659815 0.175805 0 4.69745 0.402782 0.307795 0 1.07897 0.328868 0.341487 0 0.00714916 0.330413 0.338871 0 0 9.5 0.0130861 0.01121 0.000700768 1.72354e-06 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 15 1 1 0 0 0 0 0
0 1 0 -9.5 0.150732 0.710008 0 -5.40797 0.289678 0.443332 0 -1.66706 0.347578 0.326729 0 -0.0301265 0.325555 0.335452 0 -0 -9.5 0.000112041 0.000608576 2.74718e-05 2.08797e-06 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 20 1 1 0 0 0 0 0
1 0 0 9.5 0.768792 0.120094 0 6.22597 0.509309 0.255807 0 2.5757 0.331265 0.350292 0 0.126953 0.313957 0.37079 0 0 9.5 0.0484729 0.0571192 8.51851e-05 0.00271102 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 25 1 1 0 0 0 0 0
0 1 0 -9.5 0.0847198 0.836381 0 -7.16769 0.202329 0.611443 0 -3.97959 0.336684 0.36263 0 -0.534978 0.354143 0.318428 0 -0 -9.5 0.0113912 0.00521297 0.000111795 0.000972811 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 30 1 1 0 0 0 0 0
1 0 0 9.5 0.914345 0.0426346 0 8.25185 0.770158 0.114469 0 6.14866 0.504484 0.247302 0 2.25439 0.364462 0.319184 0 0 9.5 0.035697 0.000349302 2.10611e-06 0.00152491 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 35 1 1 0 0 0 0 0
0.326613 0.332964 0.340423 0.00468804 0.326613 0.332964 0.340423 0.00468804 0.326613 0.332964 0.340423 0.00468804 0.326613 0.332964 0.340423 0.00468804 0.326613 0.332964 0.340423 0.00468804 0 0.0525137 0.000686974 8.5468e-05 3.3756e-05 1 1 0 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 12 1 1 0 0 0 0 1

scoreDistrN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,170)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

selfBonusScoreN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,61)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

valueTargetsNCHW
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,1,5,5)}
-1 -1 -1 -1 -1 0 0 -1 -1 -1 0 -1 -1 -1 -1 1 1 -1 -1 -1 0 -1 -1 -1 -1
1 1 1 1 1 0 0 1 1 1 0 1 1 1 1 -1 -1 1 1 1 0 1 1 1 1
-1 -1 -1 -1 -1 0 0 -1 -1 -1 0 -1 -1 -1 -1 1 1 -1 -1 -1 0 -1 -1 -1 -1
1 1 1 1 1 0 0 1 1 1 0 1 1 1 1 -1 -1 1 1 1 0 1 1 1 1
-1 -1 -1 -1 -1 0 0 -1 -1 -1 0 -1 -1 -1 -1 1 1 -1 -1 -1 0 -1 -1 -1 -1
1 1 1 1 1 0 0 1 1 1 0 1 1 1 1 -1 -1 1 1 1 0 1 1 1 1
-1 -1 -1 -1 -1 0 0 -1 -1 -1 0 -1 -1 -1 -1 1 1 -1 -1 -1 0 -1 -1 -1 -1
1 1 1 1 1 0 0 1 1 1 0 1 1 1 1 -1 -1 1 1 1 0 1 1 1 1
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

HASH: 6C551B368DDA0C4D7310D9E43A2B282D
   A B C D E
 5 . . . . .
 4 . . . . .
 3 . . . . .
 2 . . . . .
 1 . . . . .


HASH: 3728ADC1DFFE80EE4880F437FF24E0FB
   A B C D E
 5 O X X O O
 4 . . X . .
 3 . X X X X
 2 . . X X O
 1 X X X X .


Encore phase 1
Rules koSIMPLEscoreTERRITORYsui0komi5
Ko prohib hash 00000000000000000000000000000000
White bonus score 0
Game result 0 Empty 0 0 0
Last moves E5 B4 C4 E4 D1 B2 C1 D5 A5 E2 B3 D4 A4 B1 C2 pass C3 C5 pass A3 A1 A2 D3 B5 E3 A5 D2 E5 pass A4 pass pass A1 pass B1 A5 C5 D5 B5 E5
binaryInputNCHWPacked
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|u1','fortran_order':False,'shape':(9,22,4)}
FFFFFF80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
FFFFFF80024000000900010008000000004000000300010000000000000000000000000000000100004000000100000002000000080000000840000008400000080000000000000000000000000000000000000000000000
FFFFFF80810003001240900000000000800000001340100000000000000000000000000000001000800000001000000000000200000080008000000080000000000000000000000000000000000000000000000000000000
FFFFFF8012C094008510430002000000851084000000530000000000000000000000000000004000000004000400000000800000001000000200840003000000030000000000000000000000000000000000000000000000
FFFFFF808518430032E0940086200000000084000118530000000000000000000000000000200000000000002000000000080000000000000000840000008400000084000001080000000000000000000000000000000000
FFFFFF8072E19400011E430000000000013FD70072C000000000000000000000000000000002000040000000000400000001000000000800011E430000000000000000000000208000000000000000000000000000000000
FFFFFF80011E6300FEE19400FFFFF700000000000000000000000000000000000000000004000000000000000800000000002000800000000000000000218400002184000000000000000000000000000000000000000000
FFFFFF8000001000011E6F0000001000000000000000000000000000000000000000000000000400000000000000080000000000000000000000100000001000000010000000000000000000000000000000000000000000
FFFFFF80090000008200000000000000880000000300000000000000000000000000000080000000010000000200000008000000000000000800000008000000080000000000000000000000000000000000000000000000

globalInputNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(9,14)}
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 0.4 0 0 0 1 0 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 0.4 0 0 0 1 0 0 0 0
0 1 0 0 1 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 0.4 0 0 0 1 0 0 0 0
0 1 0 0 0 -0.266667 0 0 0 1 0 0 0 0
0 1 0 1 1 0.4 0 0 0 1 1 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0

policyTargetsNCMove
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<i2','fortran_order':False,'shape':(9,1,26)}
22 0 0 6 27 2 0 0 8 4 8 0 0 9 5 0 0 0 8 0 0 0 0 0 0 0
9 0 2 10 0 0 0 0 0 0 0 18 0 10 0 0 21 2 0 0 0 5 4 0 0 18
0 7 16 0 0 4 0 0 11 0 0 27 0 7 0 13 0 7 6 0 0 0 0 0 0 1
0 3 0 0 5 0 0 0 0 0 0 0 3 3 2 0 0 0 21 0 7 0 0 0 4 51
0 1 0 0 0 0 0 0 0 0 0 0 0 8 12 24 0 0 8 0 33 0 0 0 0 13
32 0 0 0 3 4 0 0 0 0 0 0 0 0 0 0 0 0 16 0 9 0 0 0 19 16
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 34 0 0 0 6 59
32 0 0 0 5 24 2 0 23 8 1 0 0 0 0 0 4 0 0 0 0 0 0 0 0 0
0 1 0 0 0 17 0 0 0 0 0 0 0 0 0 13 2 2 8 7 3 0 6 5 6 29

globalTargetsNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(9,54)}
1 0 0 20 0.54934 0.225664 0 6.48114 0.353444 0.324677 0 0.615868 0.332373 0.337205 0 0.000201132 0.329199 0.342628 0 0 20 0.000674825 0.00302192 0.000444038 3.03504e-06 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 0 1 0 0 0 0 0 0
0 1 0 -20 0.208828 0.582064 0 -7.46146 0.317826 0.364659 0 -0.951547 0.334055 0.332284 0 -0.000847567 0.328103 0.335387 0 -0 -20 0.00108108 0.00157247 0.000454442 8.84778e-06 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 5 1 0 0 0 0 0 0
1 0 0 20 0.619957 0.189734 0 8.59006 0.382714 0.308462 0 1.47019 0.334464 0.332247 0 0.00357164 0.332304 0.334536 0 0 20 0.00883303 0.00474661 0.000121213 0.00019713 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 10 1 0 0 0 0 0 0
0 1 0 -20 0.168242 0.663144 0 -9.88937 0.295795 0.408962 0 -2.27152 0.334752 0.333234 0 -0.0150509 0.33224 0.33563 0 -0 -20 1.62407e-05 0.000124429 0.0029104 0.000125361 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 15 1 0 0 0 0 0 0
1 0 0 20 0.713202 0.143034 0 11.3852 0.450726 0.274534 0 3.50961 0.334459 0.335544 0 0.0634242 0.336122 0.338152 0 0 20 0.00653063 0.000349686 2.53982e-05 2.31749e-06 1 1 1 1 0 0 0 0 0 0 0 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 20 1 0 0 0 0 0 0
0 1 0 -20 0.113343 0.771265 0 -13.1073 0.239191 0.51676 0 -5.42252 0.323165 0.347284 0 -0.267269 0.332109 0.334008 0 -0 -20 0.00295795 0.000266987 0.000369029 6.59435e-06 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 25 1 0 0 0 0 0 0
1 0 0 20 0.836379 0.0811919 0 15.0899 0.612804 0.191711 0 8.37808 0.371723 0.308833 0 1.12627 0.332302 0.324493 0 0 20 3.96407e-06 0.00152987 1.97931e-06 0.000458957 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -4 0 0 0 30 1 0 0 0 0 0 0
0 1 0 -20 0.0440778 0.91228 0 -17.3723 0.118412 0.764402 0 -12.9446 0.256469 0.490183 0 -4.74609 0.33947 0.330186 0 -0 -20 0.000681786 1.92402e-06 0.000484151 0.000200133 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 35 1 0 0 0 0 0 0
0.33161 0.333328 0.335062 -0.244437 0.33161 0.333328 0.335062 -0.244437 0.33161 0.333328 0.335062 -0.244437 0.33161 0.333328 0.335062 -0.244437 0.33161 0.333328 0.335062 -0.244437 0 0.0127089 0.00663578 0.000316737 2.14513e-05 1 1 0 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 4 1 0 0 0 0 0 1

scoreDistrN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,170)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

selfBonusScoreN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,61)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

valueTargetsNCHW
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,1,5,5)}
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

)%%";
  expect("Test training write",out,expected);



  NeuralNet::globalCleanup();
}
