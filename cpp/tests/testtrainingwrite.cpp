#include "../tests/tests.h"
using namespace TestCommon;

#include "../neuralnet/nneval.h"
#include "../dataio/trainingwrite.h"
#include "../program/play.h"

static NNEvaluator* startNNEval(
  const string& seed, Logger& logger,
  int defaultSymmetry, bool inputsUseNHWC, bool cudaUseNHWC, bool cudaUseFP16
) {
  //Placeholder, doesn't actually do anything since we have debugSkipNeuralNet = true
  string modelFile = "/dev/null";
  int modelFileIdx = 0;
  int maxBatchSize = 16;
  int maxConcurrentEvals = 1024;
  int posLen = NNPos::MAX_BOARD_LEN;
  bool requireExactPosLen = false;
  int nnCacheSizePowerOfTwo = 16;
  int nnMutexPoolSizePowerOfTwo = 12;
  bool debugSkipNeuralNet = true;
  NNEvaluator* nnEval = new NNEvaluator(
    modelFile,
    modelFileIdx,
    maxBatchSize,
    maxConcurrentEvals,
    posLen,
    requireExactPosLen,
    inputsUseNHWC,
    nnCacheSizePowerOfTwo,
    nnMutexPoolSizePowerOfTwo,
    debugSkipNeuralNet
  );
  (void)inputsUseNHWC;

  int numNNServerThreadsPerModel = 1;
  bool nnRandomize = false;
  vector<int> cudaGpuIdxByServerThread = {0};

  nnEval->spawnServerThreads(
    numNNServerThreadsPerModel,
    nnRandomize,
    seed,
    defaultSymmetry,
    logger,
    cudaGpuIdxByServerThread,
    cudaUseFP16,
    cudaUseNHWC
  );

  return nnEval;
}

void Tests::runTrainingWriteTests() {
  cout << "Running training write tests" << endl;
  string tensorflowGpuVisibleDeviceList = "";
  double tensorflowPerProcessGpuMemoryFraction = 0.3;
  NeuralNet::globalInitialize(tensorflowGpuVisibleDeviceList,tensorflowPerProcessGpuMemoryFraction);

  int inputsVersion = 3;
  int maxRows = 256;
  int posLen = 5;
  double firstFileMinRandProp = 1.0;
  int debugOnlyWriteEvery = 5;

  ostringstream out;
  Logger logger;
  logger.setLogToStdout(false);
  logger.setLogTime(false);
  logger.addOStream(out);

  auto run = [&](const string& seedBase, const Rules& rules) {
    TrainingDataWriter dataWriter(&out,inputsVersion, maxRows, firstFileMinRandProp, posLen, debugOnlyWriteEvery, seedBase+"dwriter");

    NNEvaluator* nnEval = startNNEval(seedBase+"nneval",logger,0,true,false,false);

    SearchParams params;
    params.maxVisits = 100;

    MatchPairer::BotSpec botSpec;
    botSpec.botIdx = 0;
    botSpec.botName = string("test");
    botSpec.nnEval = nnEval;
    botSpec.baseParams = params;

    Board initialBoard(5,5);
    Player initialPla = P_BLACK;
    int initialEncorePhase = 0;
    BoardHistory initialHist(initialBoard,initialPla,rules,initialEncorePhase);

    int numExtraBlack = 0;
    bool doEndGameIfAllPassAlive = true;
    bool clearBotAfterSearch = true;
    int maxMovesPerGame = 40;
    vector<std::atomic<bool>*> stopConditions;
    FancyModes fancyModes;
    fancyModes.initGamesWithPolicy = true;
    fancyModes.forkSidePositionProb = 0.10;
    bool recordFullData = true;
    Rand rand(seedBase+"play");
    FinishedGameData* gameData = Play::runGame(
      initialBoard,initialPla,initialHist,numExtraBlack,
      botSpec,botSpec,
      seedBase+"search",
      doEndGameIfAllPassAlive, clearBotAfterSearch,
      logger, false, false,
      maxMovesPerGame, stopConditions,
      fancyModes, recordFullData, posLen,
      rand
    );

    out << gameData->startHist.getRecentBoard(0) << endl;
    gameData->endHist.printDebugInfo(out,gameData->endHist.getRecentBoard(0));

    dataWriter.writeGame(*gameData);
    delete gameData;

    dataWriter.flushIfNonempty();

    delete nnEval;
  };

  run("testtrainingwrite-tt",Rules::getTrompTaylorish());

  Rules rules;
  rules.koRule = Rules::KO_SIMPLE;
  rules.scoringRule = Rules::SCORING_TERRITORY;
  rules.multiStoneSuicideLegal = false;
  rules.komi = 5;
  run("testtrainingwrite-jp",rules);

  string expected = R"%%(
HASH: 8333137CA06AB48A180FF32D05FA698B
   A B C D E
 5 . . . . .
 4 . . . . .
 3 . . . . .
 2 . . . . .
 1 . . . X .


HASH: B9CFBAD2B2C1AB448A59CB76C2C294F5
   A B C D E
 5 . X X X .
 4 O . X . X
 3 X O X X .
 2 X . X X X
 1 X X X X X


Encore phase 0
Rules koPOSITIONALscoreAREAsui1komi7.5
Ko prohib hash 00000000000000000000000000000000
White bonus score 0
Game result 1 Black -17.5 0
Last moves D1 B3 pass B2 C2 B5 D5 E2 C5 A5 D2 A4 A1 E3 B1 C4 A2 pass A3 B4 D3 E1 C1 pass E4 D4 E1 E3 C3 A4 E2 D4 B5 B3 C4
binaryInputNCHWPacked
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|u1','fortran_order':False,'shape':(8,22,4)}
FFFFFF80000000000000010000000000000000000000010000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000FFFFFF800000000000000000
FFFFFF80000041004010800000000000000000004000410000000000000000000000000040000000000040000000800000000000001000000000000000000000000000000000000000004100401080000000000000000000
FFFFFF80C01090003000610000000000C0001000300000000000000000000000000000000000200080000000200000000000100010000000C0001000C00000004000000000000000C0109000300061000000000000000000
FFFFFF8030006D00C512900000000000F4000C000102100000000000000000000000000001000000000004000002000000000800040000003000000000000000000008000000000030006F00C71290000000000000000000
FFFFFF80C712900030256D0000210C00F712900000000000000000000000000000000000000400000200000000200000000000000001000030021000300000000010800000800000C712900030256F000000000000000000
FFFFFF8030656F00C7908000F79080000040000000000000000000000000000000000000008000000040000000000000000002000000008000000000C7108000F71290800000000038677F80C79080000000000000000000
FFFFFF8004000000306D7F8000000000040000000040000000000000000000000000000000001000040000000008000000020000000000800400000004020000000200000000000004000000386F7F800000000000000000
FFFFFF8030256F00C71A9080C73FFF803000000000000000000000000000000000000000000800000000020000000080000400000200000030000000F7129080300210800000000030256F00C71A90800000000000000000

globalInputNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(8,14)}
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 1 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 1 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 1 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5

policyTargetsNCMove
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<i2','fortran_order':False,'shape':(8,1,26)}
0 8 0 0 7 0 0 0 5 0 0 27 0 3 0 12 0 14 0 2 11 0 0 0 5 5
4 0 0 31 8 4 1 0 4 0 0 0 15 9 0 3 0 0 11 0 5 4 0 0 0 0
0 0 0 0 0 18 0 17 1 10 14 0 11 0 0 3 0 0 0 0 6 0 2 0 15 2
0 0 0 0 0 0 0 0 11 4 10 0 4 22 0 37 0 0 0 0 0 0 5 0 3 3
0 0 0 0 6 0 0 0 3 15 0 0 19 0 0 0 0 0 0 0 0 0 7 0 40 9
0 0 0 0 8 0 0 0 0 0 0 0 4 0 13 0 0 0 0 5 0 0 0 0 69 0
14 4 0 0 0 0 11 0 56 0 0 3 0 0 0 0 8 0 0 0 0 0 0 0 0 3
0 0 0 0 83 0 0 0 5 10 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1

globalTargetsNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(8,54)}
0 1 0 -0.669501 0.206236 0.589989 0 -0.256909 0.316429 0.368023 0 -0.0347488 0.333072 0.332159 0 -3.78298e-05 0.336522 0.330911 0 -0 -17.5 0.000576856 0.00121556 0.000296034 0.000383017 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 0 0 1 0 0 0 0 0
1 0 0 0.669501 0.629104 0.187051 0 0.295769 0.387995 0.307216 0 0.0536887 0.33462 0.329558 0 0.000159415 0.330823 0.326016 0 0 17.5 0.000676337 1.8431e-06 0.000464757 5.3221e-06 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 5 0 1 0 0 0 0 0
0 1 0 -0.669501 0.165604 0.673612 0 -0.340506 0.295561 0.417003 0 -0.0829518 0.335125 0.335186 0 -0.000671772 0.334215 0.33128 0 -0 -17.5 0.000193208 0.000262273 0.00011319 1.02005e-06 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 10 0 1 0 0 0 0 0
1 0 0 0.669501 0.724486 0.140179 0 0.39201 0.460621 0.274776 0 0.128165 0.332608 0.339611 0 0.00283084 0.33219 0.340088 0 0 17.5 0.00319635 0.00389762 0.00469312 6.50522e-05 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 15 0 1 0 0 0 0 0
0 1 0 -0.669501 0.110451 0.78401 0 -0.451304 0.240743 0.531397 0 -0.198021 0.342593 0.340156 0 -0.0119291 0.34232 0.329307 0 -0 -17.5 0.0204912 0.00748131 0.000114358 1.43395e-05 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 20 0 1 0 0 0 0 0
1 0 0 0.669501 0.85318 0.073916 0 0.519567 0.643185 0.17998 0 0.305953 0.38819 0.310375 0 0.0502693 0.329208 0.342296 0 0 17.5 0.00587249 0.00085201 0.00141192 0.0002274 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 25 0 1 0 0 0 0 0
0 1 0 -0.669501 0.0343797 0.930865 0 -0.598155 0.0949813 0.809073 0 -0.472713 0.222054 0.55422 0 -0.211834 0.332237 0.33721 0 -0 -17.5 0.00535124 0.00538304 0.000720309 0.000444519 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 30 0 1 0 0 0 0 0
0.334146 0.33602 0.329834 0.00391404 0.334146 0.33602 0.329834 0.00391404 0.334146 0.33602 0.329834 0.00391404 0.334146 0.33602 0.329834 0.00391404 0.334146 0.33602 0.329834 0.00391404 0 0.000852442 0.00213885 0.000944481 9.17673e-06 1 1 0 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 23 0 1 0 0 0 0 1

scoreDistrN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,170)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

selfBonusScoreN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,61)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

valueTargetsNCHW
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,1,5,5)}
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

HASH: 6C551B368DDA0C4D7310D9E43A2B282D
   A B C D E
 5 . . . . .
 4 . . . . .
 3 . . . . .
 2 . . . . .
 1 . . . . .


HASH: 1D4E854C483AFE31F16EFE4EB3CE9ED7
   A B C D E
 5 . X . X .
 4 O O X X .
 3 X O X X .
 2 X X X X O
 1 . X . X .


Encore phase 0
Rules koSIMPLEscoreTERRITORYsui0komi5
Ko prohib hash 00000000000000000000000000000000
White bonus score 1
Game result 1 Black -19 0
Last moves E5 B4 C4 E4 D1 C1 A2 E3 B2 A4 D3 pass D4 C5 B1 D5 B5 pass A3 E2 C3 E5 pass B3 pass E1 D2 E2 C2 C5 D5
binaryInputNCHWPacked
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|u1','fortran_order':False,'shape':(8,22,4)}
FFFFFF80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
FFFFFF80024000000900010008000000004000000300010000000000000000000000000000000100004000000100000002000000080000000840000008400000080000000000000000000000000000000000000000000000
FFFFFF80090181000642020008000000000003000142000000000000000000000000000004000000000080000002000000010000000002000800030008000300080003000000400000000000000000000000000000000000
FFFFFF80264202000985850008420200200001000184000000000000000000000000000000000400200000000080000000000000000400002042020020420300004203000000000000000000000000000000000000000000
FFFFFF8041A585003642120070000200078401000063940000000000000000000000000000001000002000000000000040000000100000000600020006420200004202000010000000000000000000000000000000000000
FFFFFF803E52120041AD85004610020039EF95000000000000000000000000000000000000000000001000000000000008000000000800003E5212003E5212007E4212000000000000000000000000000000000000000000
FFFFFF8041ADE5002610100066100000000010000000000000000000000000000000000020000000000040000000100000002000000000802610100006101000061012000002008001ADEF00000000000000000000000000
FFFFFF80090280008244000008420000800000000304000000000000000000000000000000400000000200000004000000008000800000000000000008020000080000000000000000000000000000000000000000000000

globalInputNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(8,14)}
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 0.4 0 0 0 1 0 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 1 0 0.466667 0 0 0 1 0 0 0 0
0 0 1 0 0 -0.466667 0 0 0 1 0 0 0 0
1 0 1 0 0 0.4 0 0 0 1 0 0 1 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0

policyTargetsNCMove
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<i2','fortran_order':False,'shape':(8,1,26)}
18 0 0 12 22 3 0 0 9 1 7 0 0 6 12 0 0 0 9 0 0 0 0 0 0 0
12 0 5 0 0 0 0 0 0 0 8 5 0 11 0 10 2 6 6 0 8 0 26 0 0 0
10 9 12 0 0 0 0 0 4 0 4 7 8 18 0 0 0 2 0 0 10 0 0 0 5 10
9 26 0 30 0 0 0 0 0 0 0 17 0 0 0 0 0 12 4 0 0 0 0 0 1 0
0 0 0 0 6 0 0 0 0 0 0 16 34 0 0 0 0 3 24 0 0 0 0 0 3 13
26 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 7 0 0 0 0 0 39 25
0 0 0 33 5 0 0 0 0 10 0 0 0 0 0 0 0 0 0 0 12 0 0 0 22 17
0 5 0 1 0 0 0 0 6 0 32 2 2 0 0 9 0 0 5 9 2 7 5 1 13 0

globalTargetsNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(8,54)}
1 0 0 0.691429 0.610264 0.195918 0 0.288722 0.376394 0.313232 0 0.046591 0.332434 0.335638 0 9.26077e-05 0.336624 0.334951 0 0 19 0.00142905 0.00282358 0.000616458 8.98271e-09 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 0 0 0 0 0 0 0 0
0 1 0 -0.691429 0.174732 0.652329 0 -0.332393 0.300855 0.40037 0 -0.0719855 0.334995 0.329957 0 -0.000390248 0.334171 0.324916 0 -0 -19 0.0652504 0.000320708 0.000340017 0.00014013 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 5 0 0 0 0 0 0 0
1 0 0 0.691429 0.700939 0.15055 0 0.38267 0.438454 0.282312 0 0.111221 0.333047 0.332979 0 0.0016445 0.33023 0.332782 0 0 19 0.0181524 4.28383e-05 2.08325e-05 1.72326e-06 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 10 0 0 0 0 0 0 0
0 1 0 -0.691429 0.12307 0.756977 0 -0.440551 0.255138 0.49724 0 -0.171843 0.336106 0.339646 0 -0.00692992 0.335042 0.330936 0 -0 -19 0.00305486 0.00688419 0.00120538 8.16872e-05 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 7 0 0 0 15 0 0 0 0 0 0 0
1 0 0 0.691429 0.820825 0.0902756 0 0.507188 0.58575 0.209061 0 0.265506 0.355562 0.326795 0 0.0292026 0.328326 0.345082 0 0 19 0.000980018 0.000116875 6.64598e-05 0.00103012 1 1 1 1 0 0 0 0 0 0 0 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -7 0 0 0 20 0 0 0 0 0 0 0
0 1 0 -0.691429 0.0522481 0.895611 0 -0.583904 0.136687 0.727102 0 -0.41022 0.276644 0.448988 0 -0.12306 0.341631 0.326621 0 -0 -19 0.00656276 0.000137703 2.16697e-05 0.000318113 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 25 0 0 0 0 0 0 0
1 0 0 0.691429 0.981176 0.00931828 0 0.672223 0.943527 0.0279549 0 0.63381 0.83058 0.0838646 0 0.518572 0.32232 0.335458 0 0 19 0.00635637 0.00510066 1.98975e-05 0.000256905 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 30 0 0 0 0 0 0 0
0.328505 0.342301 0.329194 -0.00127634 0.328505 0.342301 0.329194 -0.00127634 0.328505 0.342301 0.329194 -0.00127634 0.328505 0.342301 0.329194 -0.00127634 0.328505 0.342301 0.329194 -0.00127634 0 0.00167081 2.61522e-05 0.000196835 0.000258171 1 1 0 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 8 0 0 0 0 0 0 1

scoreDistrN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,170)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

selfBonusScoreN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,61)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

valueTargetsNCHW
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(8,1,5,5)}
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

)%%";
  expect("Test training write",out,expected);



  NeuralNet::globalCleanup();
}
