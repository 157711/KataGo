#include "../tests/tests.h"
using namespace TestCommon;

#include "../neuralnet/nneval.h"
#include "../dataio/trainingwrite.h"
#include "../program/play.h"

static NNEvaluator* startNNEval(
  const string& seed, Logger& logger,
  int defaultSymmetry, bool inputsUseNHWC, bool cudaUseNHWC, bool cudaUseFP16
) {
  //Placeholder, doesn't actually do anything since we have debugSkipNeuralNet = true
  string modelFile = "/dev/null";
  int modelFileIdx = 0;
  int maxBatchSize = 16;
  int maxConcurrentEvals = 1024;
  int posLen = NNPos::MAX_BOARD_LEN;
  bool requireExactPosLen = false;
  int nnCacheSizePowerOfTwo = 16;
  int nnMutexPoolSizePowerOfTwo = 12;
  bool debugSkipNeuralNet = true;
  double nnPolicyTemperature = 1.0;
  NNEvaluator* nnEval = new NNEvaluator(
    modelFile,
    modelFileIdx,
    maxBatchSize,
    maxConcurrentEvals,
    posLen,
    requireExactPosLen,
    inputsUseNHWC,
    nnCacheSizePowerOfTwo,
    nnMutexPoolSizePowerOfTwo,
    debugSkipNeuralNet,
    nnPolicyTemperature
  );
  (void)inputsUseNHWC;

  int numNNServerThreadsPerModel = 1;
  bool nnRandomize = false;
  vector<int> cudaGpuIdxByServerThread = {0};

  nnEval->spawnServerThreads(
    numNNServerThreadsPerModel,
    nnRandomize,
    seed,
    defaultSymmetry,
    logger,
    cudaGpuIdxByServerThread,
    cudaUseFP16,
    cudaUseNHWC
  );

  return nnEval;
}

void Tests::runTrainingWriteTests() {
  cout << "Running training write tests" << endl;
  string tensorflowGpuVisibleDeviceList = "";
  double tensorflowPerProcessGpuMemoryFraction = 0.3;
  NeuralNet::globalInitialize(tensorflowGpuVisibleDeviceList,tensorflowPerProcessGpuMemoryFraction);

  int inputsVersion = 3;
  int maxRows = 256;
  int posLen = 5;
  double firstFileMinRandProp = 1.0;
  int debugOnlyWriteEvery = 5;

  ostringstream out;
  Logger logger;
  logger.setLogToStdout(false);
  logger.setLogTime(false);
  logger.addOStream(out);

  auto run = [&](const string& seedBase, const Rules& rules) {
    TrainingDataWriter dataWriter(&out,inputsVersion, maxRows, firstFileMinRandProp, posLen, debugOnlyWriteEvery, seedBase+"dwriter");

    NNEvaluator* nnEval = startNNEval(seedBase+"nneval",logger,0,true,false,false);

    SearchParams params;
    params.maxVisits = 100;

    MatchPairer::BotSpec botSpec;
    botSpec.botIdx = 0;
    botSpec.botName = string("test");
    botSpec.nnEval = nnEval;
    botSpec.baseParams = params;

    Board initialBoard(5,5);
    Player initialPla = P_BLACK;
    int initialEncorePhase = 0;
    BoardHistory initialHist(initialBoard,initialPla,rules,initialEncorePhase);

    int numExtraBlack = 0;
    bool doEndGameIfAllPassAlive = true;
    bool clearBotAfterSearch = true;
    int maxMovesPerGame = 40;
    vector<std::atomic<bool>*> stopConditions;
    FancyModes fancyModes;
    fancyModes.initGamesWithPolicy = true;
    fancyModes.forkSidePositionProb = 0.10;
    bool recordFullData = true;
    Rand rand(seedBase+"play");
    FinishedGameData* gameData = Play::runGame(
      initialBoard,initialPla,initialHist,numExtraBlack,
      botSpec,botSpec,
      seedBase+"search",
      doEndGameIfAllPassAlive, clearBotAfterSearch,
      logger, false, false,
      maxMovesPerGame, stopConditions,
      fancyModes, recordFullData, posLen,
      rand
    );

    out << gameData->startHist.getRecentBoard(0) << endl;
    gameData->endHist.printDebugInfo(out,gameData->endHist.getRecentBoard(0));

    dataWriter.writeGame(*gameData);
    delete gameData;

    dataWriter.flushIfNonempty();

    delete nnEval;
  };

  run("testtrainingwrite-tt",Rules::getTrompTaylorish());

  Rules rules;
  rules.koRule = Rules::KO_SIMPLE;
  rules.scoringRule = Rules::SCORING_TERRITORY;
  rules.multiStoneSuicideLegal = false;
  rules.komi = 5;
  run("testtrainingwrite-jp",rules);

  string expected = R"%%(
HASH: 8333137CA06AB48A180FF32D05FA698B
   A B C D E
 5 . . . . .
 4 . . . . .
 3 . . . . .
 2 . . . . .
 1 . . . X .


HASH: E96F909763B40449E305523A1440AA53
   A B C D E
 5 . . X X O
 4 X . O O .
 3 X O . O O
 2 O X O . X
 1 . . X X .


Encore phase 0
Rules koPOSITIONALscoreAREAsui1komi7.5
Ko prohib hash 00000000000000000000000000000000
White bonus score 0
Game result 1 White 8.5 0 0
Last moves D1 C4 C1 D3 C3 E5 B2 pass E2 B3 C5 A2 A4 E3 A3 D4 D5 C2 pass pass
binaryInputNCHWPacked
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|u1','fortran_order':False,'shape':(4,22,4)}
FFFFFF80000000000000010000000000000000000000010000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000FFFFFF800000000000000000
FFFFFF80000803000904000000000000080800000104000000000000000000000000000008000000000800000004000000000200010000000000000000000000000000000000000000080300090400000000000000000000
FFFFFF80091400002008930000080000291000000004900000000000000000000000000020000000001000000000100000000000000080002800000000000000000000005000000009140000200893800000000000000000
FFFFFF802428930009970000001900002C209000000000000000000000000000000000000080000000200000000200000400000000010000200110002001100020011000000000002428938009D700000000000000000000

globalInputNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(4,14)}
0 0 0 0 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5
0 0 0 1 0 0.5 1 0.5 1 0 0 0 0 0.5
0 0 0 0 0 -0.5 1 0.5 1 0 0 0 0 -0.5

policyTargetsNCMove
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<i2','fortran_order':False,'shape':(4,1,26)}
8 0 0 11 2 0 0 13 0 6 11 3 8 0 4 3 9 2 5 0 0 0 7 0 0 7
9 0 5 0 0 2 8 0 0 10 1 0 0 0 6 0 17 0 0 11 12 2 0 0 16 0
13 5 0 5 0 0 5 0 8 3 8 0 0 0 10 17 0 14 0 0 0 8 0 0 0 3
15 11 0 57 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 0 12 0 0 0 0 0

globalTargetsNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(4,54)}
1 0 0 8.5 0.735021 0.133311 0 4.97696 0.474468 0.264254 0 1.62718 0.341243 0.331631 0 0.0359404 0.343373 0.331872 0 0 8.5 0.00213672 0.00154229 3.79464e-07 0.000866494 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 0 0 1 0 0 0 0 0
0 1 0 -8.5 0.103078 0.795267 0 -5.72976 0.22662 0.549383 0 -2.51408 0.325186 0.351557 0 -0.151453 0.341467 0.325192 0 -0 -8.5 0.00116134 0.00558524 1.09384e-05 0.000204231 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 5 0 1 0 0 0 0 0
1 0 0 8.5 0.864537 0.068517 0 6.59643 0.665359 0.169234 0 3.88438 0.407124 0.299691 0 0.63822 0.339362 0.333326 0 0 8.5 0.00858375 7.89009e-05 0.000244324 0.000271237 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 7.5 1 0 0 10 0 1 0 0 0 0 0
0 1 0 -8.5 0.0288577 0.943095 0 -7.59418 0.0812804 0.839771 0 -6.00157 0.200884 0.604358 0 -2.68945 0.333962 0.342797 0 -0 -8.5 0.0019938 1.34119e-05 0.000820076 7.43167e-05 1 1 1 1 0 0 1 1 1 1 1 2.87864e+06 1.76596e+06 1.00937e+06 980071 3.88882e+06 1.02858e+06 -7.5 1 0 0 15 0 1 0 0 0 0 0

scoreDistrN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(4,170)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

selfBonusScoreN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(4,61)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

valueTargetsNCHW
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(4,1,5,5)}
0 0 -1 -1 1 -1 0 1 1 1 -1 1 1 1 1 1 -1 1 0 -1 0 0 -1 -1 -1
0 0 1 1 -1 1 0 -1 -1 -1 1 -1 -1 -1 -1 -1 1 -1 0 1 0 0 1 1 1
0 0 -1 -1 1 -1 0 1 1 1 -1 1 1 1 1 1 -1 1 0 -1 0 0 -1 -1 -1
0 0 1 1 -1 1 0 -1 -1 -1 1 -1 -1 -1 -1 -1 1 -1 0 1 0 0 1 1 1

HASH: 6C551B368DDA0C4D7310D9E43A2B282D
   A B C D E
 5 . . . . .
 4 . . . . .
 3 . . . . .
 2 . . . . .
 1 . . . . .


HASH: F2BA9FC392573166F8943CF121E20802
   A B C D E
 5 O . X . .
 4 . X O O O
 3 . O O O O
 2 . O O O O
 1 O O O O O


Encore phase 2
Rules koSIMPLEscoreTERRITORYsui0komi5
Ko prohib hash 00000000000000000000000000000000
White bonus score -4
Game result 0 Empty 0 0 0
Last moves E5 C3 A2 C1 B5 B1 B3 E1 B4 E3 C5 D4 D3 E4 A3 E2 C2 C4 D1 A5 pass B2 pass pass D5 D2 pass D1 A4 C2 pass A1 pass A5 B4 B3 C5 D3 pass pass
binaryInputNCHWPacked
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|u1','fortran_order':False,'shape':(9,22,4)}
FFFFFF80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
FFFFFF80000802004801000000000000080000004001020000000000000000000000000040000000000002000001000000080000080000000800000008000000080000001040000000000000000000000000000000000000
FFFFFF804A110000000A06800000000008000080000B000000000000000000000000000000020000020000000000008000100000000004000800000008000000080000000000000000000000000000000000000000000000
FFFFFF8000CA06806A350000080400000008008000C2000000000000000000000000000000200000004000000004000000800000200000000000000000000000080000000000000000000000000000000000000000000000
FFFFFF806A35410081CA16808804010001CA56800000000000000000000000000000000080000000000001000100000000004000000010008004010000040700000440000000000000000000000000000000000000000000
FFFFFF8081CA96807A35410081CED7807A3100000000000000000000000000000000000010000000000000000000000000008000000000008000000080040000800400000000000000000000000000000000000000000000
FFFFFF807E31000001CAF780000000007FFBF780000000000000000000000000000000000000400004000000000001000000000000002000000000007E310000FA3100000000000000000000000000000000000000000000
FFFFFF8081CAFF800200000000000000800000000200000000000000000000000000000002000000800000000000000000000800000000008000000000000000000000000000000000000000000000000000000000000000
FFFFFF80080100008008000000000000880000000001000000000000000000000000000080000000000100000008000008000000000000008800000008000000080000004400000000000000000000000000000000000000

globalInputNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(9,14)}
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 0.4 0 0 0 1 0 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 0 0 0 0 0.4 0 0 0 1 0 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0
0 1 1 0 1 0.333333 0 0 0 1 1 0 0 0
0 0 0 1 0 -0.2 0 0 0 1 1 0 0 0
0 0 1 0 1 0.133333 0 0 0 1 1 0 0 0
0 0 0 0 0 -0.333333 0 0 0 1 0 0 0 0

policyTargetsNCMove
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<i2','fortran_order':False,'shape':(9,1,26)}
22 0 0 4 23 5 0 0 7 8 5 0 0 3 10 0 0 0 12 0 0 0 0 0 0 0
0 0 0 1 0 0 7 16 4 11 17 0 0 0 4 0 7 0 0 0 4 18 0 5 0 5
9 0 32 0 0 10 0 8 3 0 26 0 0 0 0 0 0 0 4 0 1 0 0 0 0 6
10 0 0 12 0 1 0 21 0 0 0 0 0 0 0 0 3 11 0 31 0 0 0 2 0 8
0 0 0 26 0 0 0 0 0 0 0 0 0 0 0 0 8 0 11 0 9 0 0 0 0 45
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 85 0 0 0 0 0 0 14
19 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 37 0 0 0 0 43
0 0 8 4 11 0 0 0 0 0 7 31 0 9 0 6 0 0 0 0 0 0 0 0 0 23
0 4 0 5 0 11 5 0 10 16 8 4 0 5 6 0 0 5 0 14 0 2 0 0 2 2

globalTargetsNC
-109 78 85 77 80 89 1 0 -10 0 {'descr':'<f4','fortran_order':False,'shape':(9,54)}
0 1 0 -16 0.224716 0.550712 0 -5.18492 0.322559 0.355244 0 -0.492694 0.333264 0.33664 0 -0.000160905 0.332415 0.340303 0 -0 -16 0.0069167 0.00267462 0.000492438 2.352e-05 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 0 1 0 0 0 0 0 0
1 0 0 16 0.582933 0.208322 0 5.96917 0.364688 0.316771 0 0.761238 0.33031 0.332961 0 0.000678054 0.323236 0.335304 0 0 16 0.00785179 0.000119619 0.00041694 0.000626216 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 5 1 0 0 0 0 0 0
0 1 0 -16 0.189388 0.620913 0 -6.87205 0.30765 0.382856 0 -1.17615 0.330993 0.33215 0 -0.00285731 0.333288 0.332651 0 -0 -16 0.0146967 0.00143832 1.90921e-05 0.000171865 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 10 1 0 0 0 0 0 0
1 0 0 16 0.66455 0.168185 0 7.9115 0.410383 0.295705 0 1.81721 0.331903 0.335313 0 0.0120407 0.33344 0.328484 0 0 16 0.0135935 0.000330587 2.39446e-06 5.36936e-07 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 6 0 0 0 15 1 0 0 0 0 0 0
0 1 0 -16 0.142703 0.71505 0 -9.10816 0.273373 0.453876 0 -2.80769 0.331567 0.336665 0 -0.0507394 0.331281 0.332132 0 -0 -16 9.48148e-05 0.00177667 0.000265198 0.000198499 1 1 1 1 0 0 0 0 0 0 0 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 20 1 0 0 0 0 0 0
1 0 0 16 0.772879 0.113816 0 10.4858 0.52006 0.240475 0 4.33802 0.352737 0.324309 0 0.213815 0.351046 0.324936 0 0 16 0.00443337 0.00439421 0.000803131 0.00137119 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 5 0 0 0 25 1 0 0 0 0 0 0
0 1 0 -16 0.0812155 0.837921 0 -12.0719 0.192197 0.616353 0 -6.70246 0.312031 0.377282 0 -0.901016 0.338787 0.333248 0 -0 -16 0.00257313 0.00366746 0.000337574 5.65377e-07 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -3 0 0 0 30 1 0 0 0 0 0 0
1 0 0 16 0.913267 0.0435414 0 13.8979 0.766958 0.116958 0 10.3556 0.495054 0.253189 0 3.79688 0.333178 0.332478 0 0 16 0.0015703 0.00208129 0.000160907 3.55826e-05 1 1 1 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 2 0 0 0 35 1 0 0 0 0 0 0
0.334011 0.328628 0.337362 -0.374782 0.334011 0.328628 0.337362 -0.374782 0.334011 0.328628 0.337362 -0.374782 0.334011 0.328628 0.337362 -0.374782 0.334011 0.328628 0.337362 -0.374782 0 0.000141825 0.000749367 3.55002e-06 2.37082e-06 1 1 0 1 0 0 1 1 1 1 1 3.401e+06 3.73478e+06 585445 1.45281e+06 3.76859e+06 3244 -5 0 0 0 4 1 0 0 0 0 0 1

scoreDistrN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,170)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

selfBonusScoreN
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,61)}
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

valueTargetsNCHW
-109 78 85 77 80 89 1 0 -10 0 {'descr':'|i1','fortran_order':False,'shape':(9,1,5,5)}
-1 0 1 0 0 0 1 -1 -1 -1 0 -1 -1 -1 -1 0 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 0 -1 0 0 0 -1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 1 1
-1 0 1 0 0 0 1 -1 -1 -1 0 -1 -1 -1 -1 0 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 0 -1 0 0 0 -1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 1 1
-1 0 1 0 0 0 1 -1 -1 -1 0 -1 -1 -1 -1 0 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 0 -1 0 0 0 -1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 1 1
-1 0 1 0 0 0 1 -1 -1 -1 0 -1 -1 -1 -1 0 -1 -1 -1 -1 -1 -1 -1 -1 -1
1 0 -1 0 0 0 -1 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 1 1
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0


)%%";
  expect("Test training write",out,expected);



  NeuralNet::globalCleanup();
}
